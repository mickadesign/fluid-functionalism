{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "checkbox-group",
  "title": "Checkbox Group",
  "description": "Animated checkbox group with proximity hover, contiguous selection merging, and spring-animated check marks. Built on Radix UI Checkbox.",
  "dependencies": [
    "framer-motion",
    "@radix-ui/react-checkbox"
  ],
  "registryDependencies": [
    "utils",
    "springs",
    "font-weight",
    "shape-context",
    "use-proximity-hover"
  ],
  "files": [
    {
      "path": "registry/default/checkbox-group.tsx",
      "content": "\"use client\";\n\nimport {\n  useRef,\n  useState,\n  useEffect,\n  createContext,\n  useContext,\n  forwardRef,\n  type ReactNode,\n  type HTMLAttributes,\n} from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\";\nimport { cn } from \"@/lib/utils\";\nimport { springs } from \"@/lib/springs\";\nimport { fontWeights } from \"@/lib/font-weight\";\nimport { useProximityHover } from \"@/hooks/use-proximity-hover\";\nimport { useShape } from \"@/lib/shape-context\";\n\ninterface CheckboxGroupContextValue {\n  registerItem: (index: number, element: HTMLElement | null) => void;\n  activeIndex: number | null;\n}\n\nconst CheckboxGroupContext = createContext<CheckboxGroupContextValue | null>(\n  null\n);\n\nfunction useCheckboxGroup() {\n  const ctx = useContext(CheckboxGroupContext);\n  if (!ctx)\n    throw new Error(\"useCheckboxGroup must be used within a CheckboxGroup\");\n  return ctx;\n}\n\ninterface CheckboxGroupProps extends HTMLAttributes<HTMLDivElement> {\n  children: ReactNode;\n  checkedIndices: Set<number>;\n}\n\nconst CheckboxGroup = forwardRef<HTMLDivElement, CheckboxGroupProps>(\n  ({ children, checkedIndices, className, ...props }, ref) => {\n    const containerRef = useRef<HTMLDivElement>(null);\n    const groupIdCounter = useRef(0);\n    const prevGroupMap = useRef(new Map<number, number>());\n\n    const {\n      activeIndex,\n      setActiveIndex,\n      itemRects,\n      sessionRef,\n      handlers,\n      registerItem,\n      measureItems,\n    } = useProximityHover(containerRef);\n\n    useEffect(() => {\n      measureItems();\n    }, [measureItems, children]);\n\n    // Group contiguous checked indices into runs with stable IDs\n    const runs: { start: number; end: number }[] = [];\n    const sortedChecked = [...checkedIndices].sort((a, b) => a - b);\n    for (const idx of sortedChecked) {\n      const last = runs[runs.length - 1];\n      if (last && idx === last.end + 1) {\n        last.end = idx;\n      } else {\n        runs.push({ start: idx, end: idx });\n      }\n    }\n\n    // Assign stable IDs: reuse previous ID if any member overlaps\n    const usedIds = new Set<number>();\n    const newGroupMap = new Map<number, number>();\n    const checkedGroups = runs.map((run) => {\n      let stableId: number | null = null;\n      for (let i = run.start; i <= run.end; i++) {\n        const prevId = prevGroupMap.current.get(i);\n        if (prevId !== undefined && !usedIds.has(prevId)) {\n          stableId = prevId;\n          break;\n        }\n      }\n      const id = stableId ?? ++groupIdCounter.current;\n      usedIds.add(id);\n      for (let i = run.start; i <= run.end; i++) {\n        newGroupMap.set(i, id);\n      }\n      return { ...run, id };\n    });\n    prevGroupMap.current = newGroupMap;\n\n    const [focusedIndex, setFocusedIndex] = useState<number | null>(null);\n\n    const activeRect = activeIndex !== null ? itemRects[activeIndex] : null;\n    const focusRect = focusedIndex !== null ? itemRects[focusedIndex] : null;\n    const isHoveringOther =\n      activeIndex !== null && !checkedIndices.has(activeIndex);\n    const shape = useShape();\n\n    return (\n      <CheckboxGroupContext.Provider value={{ registerItem, activeIndex }}>\n        <div\n          ref={(node) => {\n            (containerRef as React.MutableRefObject<HTMLDivElement | null>).current = node;\n            if (typeof ref === \"function\") ref(node);\n            else if (ref) (ref as React.MutableRefObject<HTMLDivElement | null>).current = node;\n          }}\n          onMouseEnter={handlers.onMouseEnter}\n          onMouseMove={handlers.onMouseMove}\n          onMouseLeave={handlers.onMouseLeave}\n          onFocus={(e) => {\n            const indexAttr = (e.target as HTMLElement)\n              .closest(\"[data-proximity-index]\")\n              ?.getAttribute(\"data-proximity-index\");\n            if (indexAttr != null) {\n              const idx = Number(indexAttr);\n              setActiveIndex(idx);\n              setFocusedIndex(\n                (e.target as HTMLElement).matches(\":focus-visible\") ? idx : null\n              );\n            }\n          }}\n          onBlur={(e) => {\n            // Don't clear hover when focus moves to another item within the group\n            if (containerRef.current?.contains(e.relatedTarget as Node)) return;\n            setFocusedIndex(null);\n            setActiveIndex(null);\n          }}\n          onKeyDown={(e) => {\n            const items = Array.from(\n              containerRef.current?.querySelectorAll('[role=\"checkbox\"]') ?? []\n            ) as HTMLElement[];\n            const currentIdx = items.indexOf(e.target as HTMLElement);\n            if (currentIdx === -1) return;\n\n            if ([\"ArrowDown\", \"ArrowUp\"].includes(e.key)) {\n              e.preventDefault();\n              const next = e.key === \"ArrowDown\"\n                ? (currentIdx + 1) % items.length\n                : (currentIdx - 1 + items.length) % items.length;\n              items[next].focus();\n            } else if (e.key === \"Home\") {\n              e.preventDefault();\n              items[0]?.focus();\n            } else if (e.key === \"End\") {\n              e.preventDefault();\n              items[items.length - 1]?.focus();\n            }\n          }}\n          role=\"group\"\n          className={cn(\n            \"relative flex flex-col gap-0.5 w-72 max-w-full select-none\",\n            className\n          )}\n          {...props}\n        >\n          {/* Selected backgrounds (merged for contiguous checked items) */}\n          <AnimatePresence>\n            {checkedGroups.map((group) => {\n              const startRect = itemRects[group.start];\n              const endRect = itemRects[group.end];\n              if (!startRect || !endRect) return null;\n              const mergedTop = startRect.top;\n              const mergedHeight =\n                endRect.top + endRect.height - startRect.top;\n              const mergedLeft = Math.min(startRect.left, endRect.left);\n              const mergedWidth = Math.max(startRect.width, endRect.width);\n              return (\n                <motion.div\n                  key={`group-${group.id}`}\n                  className={`absolute ${shape.mergedBg} bg-selected/50 dark:bg-accent/40 pointer-events-none`}\n                  initial={false}\n                  animate={{\n                    top: mergedTop,\n                    left: mergedLeft,\n                    width: mergedWidth,\n                    height: mergedHeight,\n                    opacity: isHoveringOther ? 0.8 : 1,\n                  }}\n                  exit={{ opacity: 0, transition: { duration: 0.12 } }}\n                  transition={{\n                    ...springs.moderate,\n                    opacity: { duration: 0.16 },\n                  }}\n                />\n              );\n            })}\n          </AnimatePresence>\n\n          {/* Hover background */}\n          <AnimatePresence>\n            {activeRect && (\n              <motion.div\n                key={sessionRef.current}\n                className={`absolute ${shape.bg} bg-accent/40 dark:bg-accent/25 pointer-events-none`}\n                initial={{\n                  opacity: 0,\n                  top: activeRect.top,\n                  left: activeRect.left,\n                  width: activeRect.width,\n                  height: activeRect.height,\n                }}\n                animate={{\n                  opacity: 1,\n                  top: activeRect.top,\n                  left: activeRect.left,\n                  width: activeRect.width,\n                  height: activeRect.height,\n                }}\n                exit={{ opacity: 0, transition: { duration: 0.12 } }}\n                transition={{\n                  ...springs.moderate,\n                  opacity: { duration: 0.16 },\n                }}\n              />\n            )}\n          </AnimatePresence>\n\n          {/* Focus ring */}\n          <AnimatePresence>\n            {focusRect && (\n              <motion.div\n                className={`absolute ${shape.focusRing} pointer-events-none z-20 border border-[#6B97FF]`}\n                initial={false}\n                animate={{\n                  left: focusRect.left - 2,\n                  top: focusRect.top - 2,\n                  width: focusRect.width + 4,\n                  height: focusRect.height + 4,\n                }}\n                exit={{ opacity: 0, transition: { duration: 0.12 } }}\n                transition={{\n                  ...springs.moderate,\n                  opacity: { duration: 0.16 },\n                }}\n              />\n            )}\n          </AnimatePresence>\n\n          {children}\n        </div>\n      </CheckboxGroupContext.Provider>\n    );\n  }\n);\n\nCheckboxGroup.displayName = \"CheckboxGroup\";\n\ninterface CheckboxItemProps extends HTMLAttributes<HTMLDivElement> {\n  label: string;\n  index: number;\n  checked: boolean;\n  onToggle: () => void;\n}\n\nconst CheckboxItem = forwardRef<HTMLDivElement, CheckboxItemProps>(\n  ({ label, index, checked, onToggle, className, ...props }, ref) => {\n    const internalRef = useRef<HTMLDivElement>(null);\n    const hasMounted = useRef(false);\n    const { registerItem, activeIndex } = useCheckboxGroup();\n\n    useEffect(() => {\n      registerItem(index, internalRef.current);\n      return () => registerItem(index, null);\n    }, [index, registerItem]);\n\n    useEffect(() => {\n      hasMounted.current = true;\n    }, []);\n\n    const isActive = activeIndex === index;\n    const skipAnimation = !hasMounted.current;\n    const shape = useShape();\n\n    return (\n      <div\n        ref={(node) => {\n          (internalRef as React.MutableRefObject<HTMLDivElement | null>).current = node;\n          if (typeof ref === \"function\") ref(node);\n          else if (ref) (ref as React.MutableRefObject<HTMLDivElement | null>).current = node;\n        }}\n        data-proximity-index={index}\n        tabIndex={0}\n        role=\"checkbox\"\n        aria-checked={checked}\n        aria-label={label}\n        onClick={onToggle}\n        onKeyDown={(e) => {\n          if (e.key === \" \" || e.key === \"Enter\") {\n            e.preventDefault();\n            onToggle();\n          }\n        }}\n        className={cn(\n          `relative z-10 flex items-center gap-2.5 ${shape.item} px-3 py-2 cursor-pointer outline-none`,\n          className\n        )}\n        {...props}\n      >\n        {/* Checkbox â€” Radix primitive for accessibility */}\n        <CheckboxPrimitive.Root\n          checked={checked}\n          onCheckedChange={() => onToggle()}\n          tabIndex={-1}\n          aria-hidden\n          className=\"relative w-[18px] h-[18px] shrink-0 appearance-none bg-transparent p-0 border-0 outline-none cursor-pointer\"\n          onClick={(e) => e.stopPropagation()}\n        >\n          {/* Border */}\n          <div\n            className={cn(\n              \"absolute inset-0 rounded-[5px] border-solid transition-all duration-80\",\n              checked\n                ? \"border-[1.5px] border-transparent\"\n                : isActive\n                ? \"border-[1.5px] border-neutral-400 dark:border-neutral-500\"\n                : \"border-[1.5px] border-border\"\n            )}\n          />\n          {/* Check mark */}\n          <AnimatePresence>\n            {checked && (\n              <CheckboxPrimitive.Indicator forceMount asChild>\n                <motion.svg\n                  width={18}\n                  height={18}\n                  viewBox=\"0 0 24 24\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  strokeWidth={2}\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  className=\"absolute inset-0 text-foreground\"\n                  initial={{ opacity: 1 }}\n                  animate={{ opacity: 1 }}\n                  exit={{ opacity: 1 }}\n                >\n                  <motion.path\n                    d=\"M6 12L10 16L18 8\"\n                    initial={{\n                      pathLength: skipAnimation ? 1 : 0,\n                    }}\n                    animate={{\n                      pathLength: 1,\n                      transition: {\n                        duration: 0.08,\n                        ease: \"easeOut\",\n                      },\n                    }}\n                    exit={{\n                      pathLength: 0,\n                      transition: {\n                        duration: 0.04,\n                        ease: \"easeIn\",\n                      },\n                    }}\n                  />\n                </motion.svg>\n              </CheckboxPrimitive.Indicator>\n            )}\n          </AnimatePresence>\n        </CheckboxPrimitive.Root>\n\n        {/* Label */}\n        <span className=\"inline-grid text-[13px]\">\n          <span\n            className=\"col-start-1 row-start-1 invisible\"\n            style={{ fontVariationSettings: fontWeights.semibold }}\n            aria-hidden=\"true\"\n          >\n            {label}\n          </span>\n          <span\n            className={cn(\n              \"col-start-1 row-start-1 transition-[color,font-variation-settings] duration-80\",\n              checked || isActive\n                ? \"text-foreground\"\n                : \"text-muted-foreground\"\n            )}\n            style={{\n              fontVariationSettings: checked\n                ? fontWeights.semibold\n                : fontWeights.normal,\n            }}\n          >\n            {label}\n          </span>\n        </span>\n      </div>\n    );\n  }\n);\n\nCheckboxItem.displayName = \"CheckboxItem\";\n\nexport { CheckboxGroup, CheckboxItem };\nexport default CheckboxGroup;\n",
      "type": "registry:ui"
    }
  ],
  "type": "registry:ui"
}